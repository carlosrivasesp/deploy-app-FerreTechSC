<app-header />
<app-sidebar />

<main class="main-content">
  <div class="separador">
    <div class="header-title">
      <a href="/listado-compras"><i class="bi bi-arrow-bar-left"></i>Regresar</a>
      <p class="title">Detalle de orden de compra</p>
    </div>

    <div class="formulario">
      <form class="row g-3" [formGroup]="compraForm">

        <!-- codigo -->
        <div class="col-md-2">
          <label for="inputNro" class="form-label">Codigo</label>
          <input
            type="text"
            class="form-control"
            id="inputNro"
            formControlName="codigo"
          />
        </div>

        <!--emision-->
        <div class="col-md-2">
          <label for="inputEmision" class="form-label">Fecha de Emisión</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
            <input type="text" class="form-control" id="inputEmision" formControlName="fechaCreacion" />
          </div>
        </div>
        <!--proveedor-->
        <div class="col-md-6">
          <label for="inputProveedor" class="form-label">Proveedor</label>
          <select id="inputProveedor" class="form-select" formControlName="proveedor">
            <option *ngFor="let proveedor of listProveedores" [ngValue]="proveedor._id">
              {{ proveedor.nroDoc }} - {{ proveedor.nombre }}
            </option>
          </select>
        </div>
        <!-- estado -->
        <div class="col-md-2">
          <label for="inputEstado" class="form-label">Estado</label>
          <input type="text" class="form-control" id="inputEstado" formControlName="estado" />
        </div>
      </form>
    </div>

    <table class="table">
      <thead>
        <tr class="header">
          <th scope="col">Código</th>
          <th scope="col">Producto / Servicio</th>
          <th scope="col">Cantidad</th>
          <th scope="col">Precio Unitario</th>
          <th scope="col">Subtotal</th>
        </tr>
      </thead>
      <tbody class="body">
        <tr *ngFor="let detalle of paginatedDetalles">
          <td>{{ detalle.get('codigo')?.value }}</td>
          <td>{{ detalle.get('descripcion')?.value }}</td>
          <td>{{ detalle.get('cantidad')?.value }}</td>
          <td>{{ detalle.get('precio')?.value }}</td>
          <td>{{ detalle.get('subtotal')?.value }}</td>
        </tr>
      </tbody>
    </table>

    <div class="position-absolute text-end" style="right: 1.5rem; bottom: 1.5rem">
      <div style="font-size: 0.85rem">
        <div>
          <strong>IGV:</strong> S/
          {{ compraForm.get("igv")?.value }}
        </div>
        <div class="mb-2">
          <strong>Total:</strong> S/
          {{ compraForm.get("total")?.value | number : "1.2-2" }}
        </div>
      </div>
    </div>
    
    <nav *ngIf="totalPages > 1" class="mt-3" aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="changePage(currentPage - 1)">Anterior</a>
        </li>
        <li class="page-item"
            *ngFor="let page of [].constructor(totalPages); let i = index"
            [class.active]="currentPage === i + 1">
          <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" (click)="changePage(currentPage + 1)">Siguiente</a>
        </li>
      </ul>
    </nav>
  </div>

</main>
